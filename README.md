# ä¸œå´è¯åˆ¸ç ”æŠ¥å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿ

## é¡¹ç›®æ¦‚è¿°

ä¸œå´è¯åˆ¸ç ”æŠ¥å¼‚å¸¸æ£€æµ‹ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºAIçš„æ™ºèƒ½åˆ†æå¹³å°ï¼Œä¸“é—¨ç”¨äºæ£€æµ‹åˆ¸å•†ç ”æŠ¥ä¸­çš„å¼‚å¸¸æ¨¡å¼å’Œå…³é”®ä¿¡æ¯ã€‚ç³»ç»Ÿé‡‡ç”¨å››å±‚å¼‚å¸¸æ£€æµ‹ä½“ç³»ï¼Œç»“åˆæ·±åº¦å­¦ä¹ å’Œä¼ ç»Ÿæœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œä¸ºç ”æŠ¥è´¨é‡æ§åˆ¶å’Œåˆè§„ç›‘ç®¡æä¾›æŠ€æœ¯æ”¯æŒã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ” å››å±‚å¼‚å¸¸æ£€æµ‹ä½“ç³»

1. **ç»Ÿè®¡å¼‚å¸¸æ£€æµ‹**
   - æ–‡æœ¬é•¿åº¦å¼‚å¸¸æ£€æµ‹
   - è¯æ±‡æ–°é¢–æ€§åˆ†æ
   - æƒ…æ„Ÿå¼ºåº¦å¼‚å¸¸è¯†åˆ«
   - æ•°å€¼é¢„æµ‹åˆç†æ€§éªŒè¯

2. **è¡Œä¸ºå¼‚å¸¸æ£€æµ‹**
   - å‘å¸ƒæ—¶æœºå¼‚å¸¸ï¼ˆé‡å¤§äº‹ä»¶å‰åï¼‰
   - å‘å¸ƒé¢‘ç‡å˜åŒ–ç›‘æ§
   - å…³æ³¨è½¬ç§»å¼‚å¸¸è¯†åˆ«
   - å†™ä½œä¹ æƒ¯çªå˜æ£€æµ‹

3. **å¸‚åœºå…³è”å¼‚å¸¸æ£€æµ‹**
   - å¼‚å¸¸æ”¶ç›Šç‡åˆ†æ
   - æˆäº¤é‡å¼‚å¸¸ç›‘æ§
   - é¢„æµ‹å‡†ç¡®æ€§è¯„ä¼°
   - ä»·æ ¼è¶‹åŠ¿ä¸€è‡´æ€§éªŒè¯

4. **è¯­ä¹‰å¼‚å¸¸æ£€æµ‹**
   - é€»è¾‘çŸ›ç›¾è¯†åˆ«
   - å†å²è§‚ç‚¹è½¬å˜åˆ†æ
   - ä¿¡æ¯æ¥æºå¯é æ€§è¯„ä¼°
   - è¯­ä¹‰ä¸€è‡´æ€§æ£€æŸ¥

### ğŸ§  AIæŠ€æœ¯æ ˆ

- **Qwen2.5-7B**: å¤§è¯­è¨€æ¨¡å‹ï¼Œæ”¯æŒ4bité‡åŒ–å’ŒLoRAå¾®è°ƒ
- **å¤šä»»åŠ¡å­¦ä¹ **: æƒ…æ„Ÿåˆ†æã€é£æ ¼è¯†åˆ«ã€å¼‚å¸¸é¢„æ£€æµ‹
- **é›†æˆå­¦ä¹ **: åŠ æƒèåˆå¤šå±‚æ£€æµ‹ç»“æœ
- **å¯è§£é‡Šæ€§**: æ³¨æ„åŠ›å¯è§†åŒ–ã€åäº‹å®è§£é‡Šã€ç›¸ä¼¼æ¡ˆä¾‹åˆ†æ

### âš¡ æ€§èƒ½ä¼˜åŒ–

- **8GBæ˜¾å­˜é€‚é…**: 4bit NF4é‡åŒ–æŠ€æœ¯
- **æ¨ç†ä¼˜åŒ–**: æ¨¡å‹ç¼“å­˜ã€æ‰¹å¤„ç†ã€ç»“æœç¼“å­˜
- **å¹¶å‘å¤„ç†**: å¼‚æ­¥IOã€å¤šè¿›ç¨‹æ•°æ®åŠ è½½
- **èµ„æºç›‘æ§**: GPUä½¿ç”¨ç‡ã€å†…å­˜å ç”¨ç›‘æ§

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- CUDA 11.8+ (æ¨è)
- 8GB+ GPUæ˜¾å­˜ (RTX 4060/4070)
- 16GB+ ç³»ç»Ÿå†…å­˜

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### åŸºç¡€ä½¿ç”¨

```python
from src.anomaly_detection.ensemble_detector import get_ensemble_detector

# åˆå§‹åŒ–æ£€æµ‹å™¨
detector = get_ensemble_detector()

# å‡†å¤‡ç ”æŠ¥æ•°æ®
report_data = {
    'text': 'ç ”æŠ¥å†…å®¹...',
    'publication_time': datetime.now(),
    'author': 'åˆ†æå¸ˆå§“å',
    'stock_codes': ['000001'],
    'rating': 'ä¹°å…¥'
}

# æ‰§è¡Œå¼‚å¸¸æ£€æµ‹
result = detector.detect_anomalies(report_data)

# æŸ¥çœ‹ç»“æœ
print(f"å¼‚å¸¸åˆ†æ•°: {result['overall_anomaly_score']:.3f}")
print(f"å¼‚å¸¸ç­‰çº§: {result['anomaly_level']}")
print(f"å¤„ç†å»ºè®®: {result['recommendations']}")
```

### æ‰¹é‡æ£€æµ‹

```python
# æ‰¹é‡æ£€æµ‹å¤šä¸ªç ”æŠ¥
reports_data = [report1, report2, report3]
batch_results = detector.batch_detect(reports_data)

# ç»Ÿè®¡åˆ†æ
anomaly_count = sum(1 for r in batch_results if r['is_anomaly'])
print(f"å¼‚å¸¸ç ”æŠ¥æ•°é‡: {anomaly_count}/{len(batch_results)}")
```

## é¡¹ç›®ç»“æ„

```
eastmoney_anomaly_detection/
â”œâ”€â”€ configs/                    # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ model_config.yaml      # æ¨¡å‹é…ç½®
â”‚   â”œâ”€â”€ training_config.yaml   # è®­ç»ƒé…ç½®
â”‚   â”œâ”€â”€ anomaly_thresholds.yaml # å¼‚å¸¸æ£€æµ‹é˜ˆå€¼
â”‚   â””â”€â”€ web_config.yaml        # WebæœåŠ¡é…ç½®
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ raw_reports/           # åŸå§‹ç ”æŠ¥TXT
â”‚   â”œâ”€â”€ processed_reports/     # é¢„å¤„ç†åæ•°æ®
â”‚   â”œâ”€â”€ market_data/           # å¸‚åœºæ•°æ®
â”‚   â”œâ”€â”€ training_data/         # è®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ models/                # æ¨¡å‹æ–‡ä»¶
â”‚   â””â”€â”€ results/               # åˆ†æç»“æœ
â”œâ”€â”€ src/                       # æºä»£ç 
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ logger.py         # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ config_loader.py  # é…ç½®åŠ è½½
â”‚   â”‚   â”œâ”€â”€ file_utils.py     # æ–‡ä»¶æ“ä½œ
â”‚   â”‚   â””â”€â”€ text_utils.py     # æ–‡æœ¬å¤„ç†
â”‚   â”œâ”€â”€ models/               # æ¨¡å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ qwen_wrapper.py   # Qwenæ¨¡å‹å°è£…
â”‚   â”œâ”€â”€ anomaly_detection/    # å¼‚å¸¸æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ statistical_detector.py    # ç»Ÿè®¡å¼‚å¸¸æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ behavioral_detector.py     # è¡Œä¸ºå¼‚å¸¸æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ market_detector.py         # å¸‚åœºå…³è”å¼‚å¸¸
â”‚   â”‚   â”œâ”€â”€ semantic_detector.py       # è¯­ä¹‰å¼‚å¸¸æ£€æµ‹
â”‚   â”‚   â””â”€â”€ ensemble_detector.py       # é›†æˆæ£€æµ‹å™¨
â”‚   â”œâ”€â”€ training/             # è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ inference/            # æ¨ç†æ¨¡å—
â”‚   â”œâ”€â”€ explainability/       # å¯è§£é‡Šæ€§
â”‚   â”œâ”€â”€ continuous_learning/  # æŒç»­å­¦ä¹ 
â”‚   â””â”€â”€ web_interface/        # Webç•Œé¢
â”œâ”€â”€ examples/                 # ç¤ºä¾‹ä»£ç 
â”‚   â””â”€â”€ detection_example.py # ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ requirements.txt          # ä¾èµ–åŒ…
```

## é…ç½®è¯´æ˜

### æ¨¡å‹é…ç½® (model_config.yaml)

```yaml
model:
  base_model: "Qwen/Qwen2.5-7B-Instruct"
  quantization:
    enabled: true
    method: "4bit_nf4"
  max_sequence_length: 2048

lora_config:
  rank: 32
  alpha: 64
  dropout: 0.1

inference:
  batch_size: 1
  temperature: 0.7
  top_p: 0.95
```

### å¼‚å¸¸æ£€æµ‹é˜ˆå€¼ (anomaly_thresholds.yaml)

```yaml
anomaly_weights:
  statistical_anomaly: 0.15
  behavioral_anomaly: 0.25
  market_correlation_anomaly: 0.35
  semantic_anomaly: 0.25

anomaly_levels:
  CRITICAL: {min: 0.8, max: 1.0}
  HIGH: {min: 0.6, max: 0.8}
  MEDIUM: {min: 0.4, max: 0.6}
  LOW: {min: 0.2, max: 0.4}
  NORMAL: {min: 0.0, max: 0.2}
```

## å¼‚å¸¸ç­‰çº§è¯´æ˜

| ç­‰çº§ | åˆ†æ•°èŒƒå›´ | æè¿° | å»ºè®®æ“ä½œ |
|------|---------|------|----------|
| CRITICAL | 0.8-1.0 | æé«˜å¼‚å¸¸åº¦ | ç«‹å³æš‚åœå‘å¸ƒï¼Œå…¨é¢å®¡æ ¸ |
| HIGH | 0.6-0.8 | é«˜å¼‚å¸¸åº¦ | æš‚ç¼“å‘å¸ƒï¼Œè¦æ±‚è¯¦ç»†è§£é‡Š |
| MEDIUM | 0.4-0.6 | ä¸­ç­‰å¼‚å¸¸åº¦ | è¦æ±‚ä½œè€…æä¾›è¯´æ˜ |
| LOW | 0.2-0.4 | è½»åº¦å¼‚å¸¸ | æ ‡è®°å…³æ³¨ï¼Œè·Ÿè¸ªè¡¨ç° |
| NORMAL | 0.0-0.2 | æ­£å¸¸èŒƒå›´ | æ­£å¸¸å‘å¸ƒæµç¨‹ |

## æŠ€æœ¯ç‰¹ç‚¹

### ğŸš€ å…ˆè¿›æŠ€æœ¯

- **å¤§æ¨¡å‹åº”ç”¨**: åŸºäºQwen2.5-7Bçš„æ·±åº¦è¯­ä¹‰ç†è§£
- **å¤šæ¨¡æ€èåˆ**: æ–‡æœ¬ã€æ•°å€¼ã€æ—¶åºæ•°æ®ç»¼åˆåˆ†æ
- **é‡åŒ–ä¼˜åŒ–**: 4bité‡åŒ–æŠ€æœ¯ï¼Œé€‚é…8GBæ˜¾å­˜
- **LoRAå¾®è°ƒ**: é«˜æ•ˆçš„æ¨¡å‹é€‚é…æ–¹æ³•

### ğŸ“Š æ£€æµ‹ç²¾åº¦

- **ç»Ÿè®¡å¼‚å¸¸**: åŸºäºZ-scoreå’Œç™¾åˆ†ä½æ•°çš„ç²¾ç¡®æ£€æµ‹
- **è¡Œä¸ºæ¨¡å¼**: æ—¶é—´åºåˆ—åˆ†æå’Œé¢‘ç‡å¼‚å¸¸è¯†åˆ«
- **å¸‚åœºå…³è”**: æ”¶ç›Šç‡å’Œæˆäº¤é‡çš„é‡åŒ–åˆ†æ
- **è¯­ä¹‰ç†è§£**: åŸºäºå¤§æ¨¡å‹çš„é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥

### ğŸ”„ æŒç»­å­¦ä¹ 

- **ç”¨æˆ·åé¦ˆ**: æ”¶é›†äººå·¥æ ‡æ³¨ç»“æœ
- **æ¨¡å‹æ›´æ–°**: å¢é‡å­¦ä¹ å’Œæ¨¡å‹æ¼‚ç§»æ£€æµ‹
- **æ€§èƒ½ç›‘æ§**: å®æ—¶è·Ÿè¸ªæ£€æµ‹æ•ˆæœ
- **å†å²æ•°æ®**: åŠ¨æ€æ›´æ–°åŸºå‡†æ•°æ®

## ä½¿ç”¨ç¤ºä¾‹

### è¿è¡Œæ¼”ç¤ºç¨‹åº

```bash
cd eastmoney_anomaly_detection
python examples/detection_example.py
```

### å…³é”®API

#### 1. åˆå§‹åŒ–æ£€æµ‹å™¨

```python
from src.anomaly_detection.ensemble_detector import get_ensemble_detector
detector = get_ensemble_detector()
```

#### 2. å•ä¸ªç ”æŠ¥æ£€æµ‹

```python
result = detector.detect_anomalies(report_data)
```

#### 3. æ‰¹é‡æ£€æµ‹

```python
batch_results = detector.batch_detect(reports_list)
```

#### 4. æ›´æ–°å†å²æ•°æ®

```python
detector.update_historical_data(historical_reports)
```

#### 5. æ·»åŠ å¸‚åœºæ•°æ®

```python
detector.market_detector.add_market_data(
    stock_code='000001',
    date=datetime.now(),
    open_price=50.0,
    close_price=52.0,
    high_price=53.0,
    low_price=49.5,
    volume=1000000
)
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

- éµå¾ªPEP 8è§„èŒƒ
- ä½¿ç”¨ç±»å‹æ³¨è§£
- å®Œæ•´çš„docstringæ–‡æ¡£
- å¼‚å¸¸å¤„ç†æœºåˆ¶
- å•å…ƒæµ‹è¯•è¦†ç›–

### æ—¥å¿—ä½¿ç”¨

```python
from src.utils.logger import get_logger
logger = get_logger(__name__)

logger.info("å¼€å§‹å¤„ç†ç ”æŠ¥æ–‡ä»¶: {}", file_path)
logger.warning("æ£€æµ‹åˆ°è´¨é‡è¾ƒä½çš„æ–‡æœ¬ï¼Œè´¨é‡åˆ†æ•°: {:.2f}", score)
logger.error("æ¨¡å‹æ¨ç†å¤±è´¥: {}", str(error))
```

### é…ç½®ç®¡ç†

```python
from src.utils.config_loader import load_config, MODEL_CONFIG
config = load_config(MODEL_CONFIG)
learning_rate = config['training']['learning_rate']
```

## æ€§èƒ½åŸºå‡†

### ç¡¬ä»¶è¦æ±‚

| é…ç½®é¡¹ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|-------|---------|----------|
| GPU | GTX 1660 (6GB) | RTX 4060 (8GB) |
| å†…å­˜ | 16GB | 32GB |
| å­˜å‚¨ | 50GBå¯ç”¨ç©ºé—´ | 100GB SSD |
| CPU | 4æ ¸å¿ƒ | 8æ ¸å¿ƒä»¥ä¸Š |

### æ€§èƒ½æŒ‡æ ‡

- **å•ä¸ªç ”æŠ¥æ£€æµ‹**: ~30-60ç§’
- **æ‰¹é‡æ£€æµ‹**: ~100ä¸ªç ”æŠ¥/å°æ—¶
- **æ¨¡å‹åŠ è½½**: ~2-5åˆ†é’Ÿ
- **æ˜¾å­˜å ç”¨**: ~6-7GB (é‡åŒ–æ¨¡å¼)

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†æ˜¾å­˜ä¸è¶³ï¼Ÿ

A: ç³»ç»Ÿå·²é’ˆå¯¹8GBæ˜¾å­˜ä¼˜åŒ–ï¼š
- å¯ç”¨4bité‡åŒ–
- è°ƒæ•´batch_size=1
- ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯
- å®šæœŸæ¸…ç†æ˜¾å­˜ç¼“å­˜

### Q: å¦‚ä½•æé«˜æ£€æµ‹å‡†ç¡®æ€§ï¼Ÿ

A: å»ºè®®ï¼š
- æä¾›å……è¶³çš„å†å²æ•°æ®
- å®šæœŸæ›´æ–°å¸‚åœºæ•°æ®
- æ”¶é›†ç”¨æˆ·åé¦ˆè¿›è¡Œæ¨¡å‹è°ƒä¼˜
- æ ¹æ®ä¸šåŠ¡åœºæ™¯è°ƒæ•´é˜ˆå€¼

### Q: å¦‚ä½•é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿï¼Ÿ

A: å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š
- REST APIæ¥å£
- Python SDKè°ƒç”¨
- æ‰¹é‡æ–‡ä»¶å¤„ç†
- æ•°æ®åº“ç›´è¿

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## è”ç³»æ–¹å¼

- é¡¹ç›®è´Ÿè´£äºº: AIå·¥ç¨‹å›¢é˜Ÿ
- é‚®ç®±: ai@example.com
- æŠ€æœ¯æ”¯æŒ: support@example.com

---

**æ³¨æ„**: æœ¬ç³»ç»Ÿä¸ºä¸“ä¸šé‡‘èå·¥å…·ï¼Œä½¿ç”¨å‰è¯·ç¡®ä¿ç¬¦åˆç›¸å…³æ³•è§„è¦æ±‚ã€‚ç³»ç»Ÿæ£€æµ‹ç»“æœä»…ä¾›å‚è€ƒï¼Œæœ€ç»ˆå†³ç­–éœ€ç»“åˆäººå·¥å®¡æ ¸ã€‚ 